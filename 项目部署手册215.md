# 项目部署手册 第一部分

### 目录

1. 系统环境准备
   - 1.1 安装Docker和Docker Compose
   - 1.2 安装Git
   - 1.3 安装Node.js和npm
2. 获取项目代码
3. 配置文件
   - 3.1 配置`wp-config.php`
   - 3.2 配置`nginx.conf`
   - 3.3 配置`docker-compose.yml`
4. 构建和启动容器
5. 初始化数据库
   - 5.1 进入数据库容器
   - 5.2 连接到MySQL数据库
   - 5.3 创建数据库和用户
6. 配置并安装WordPress Multisite
   - 6.1 访问WordPress安装页面
   - 6.2 启用Multisite功能
   - 6.3 安装Multisite网络
   - 6.4 更新`src/wp-config.php`文件
   - 6.5 更新Nginx配置文件
7. 服务拆分与微服务化
   - 7.1 用户服务
     - 7.1.1 用户服务的实现
     - 7.1.2 Dockerfile
     - 7.1.3 更新`docker-compose.yml`
   - 7.2 文章服务
     - 7.2.1 文章服务的实现
     - 7.2.2 Dockerfile
     - 7.2.3 更新`docker-compose.yml`
8. 配置负载均衡和服务发现
   - 8.1 安装Traefik
     - 8.1.1 `traefik.toml`配置文件
     - 8.1.2 `docker-compose.yml`新增Traefik服务
9. 日志和监控
   - 9.1 安装ELK Stack
     - 9.1.1 `docker-compose.yml`新增ELK服务
     - 9.1.2 `logstash.conf`文件
10. 持续集成和持续部署（CI/CD）
    - 10.1 配置GitHub Actions
    - 10.2 配置环境变量
11. 安全配置
    - 11.1 获取和配置SSL证书
      - 11.1.1 使用Let's Encrypt获取SSL证书
      - 11.1.2 更新Nginx配置文件以支持HTTPS
    - 11.2 防火墙和访问控制
      - 11.2.1 配置防火墙规则
      - 11.2.2 配置访问控制
    - 11.3 验证安全配置
      - 11.3.1 验证SSL证书
      - 11.3.2 验证防火墙和访问控制
12. 数据库一致性解决方案
    - 12.1 选择分布式事务管理器
    - 12.2 实现Saga模式
    - 12.3 数据一致性校验
13. 数据迁移
    - 13.1 使用Flyway进行数据迁移
    - 13.2 使用Liquibase进行数据迁移
14. API文档和示例代码
    - 14.1 用户API
    - 14.2 文章API
15. 自动化测试用例和脚本
    - 15.1 使用PHPUnit进行单元测试
    - 15.2 使用Jest进行JavaScript测试
16. API网关设计和配置
    - 16.1 使用Nginx作为API网关
17. 多租户支持
    - 17.1 租户ID映射实现
    - 17.2 租户注册自动化工具
18. 插件开发规范和示例代码
    - 18.1 插件开发规范
    - 18.2 插件示例代码
19. 监控和报警配置
    - 19.1 配置Prometheus
    - 19.2 配置Grafana
    - 19.3 配置报警规则
20. 安全性措施
    - 20.1 API认证与授权
    - 20.2 数据加密
    - 20.3 DDoS防护

### 系统环境准备

#### 1.1 安装Docker和Docker Compose

在所有服务器上安装Docker和Docker Compose。以下是安装命令：

```bash
# 安装Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# 安装Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# 验证安装
docker --version
docker-compose --version
```

#### 1.2 安装Git

```bash
# 安装Git
sudo apt-get update
sudo apt-get install git -y

# 验证安装
git --version
```

#### 1.3 安装Node.js和npm

```bash
# 安装Node.js和npm
curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -
sudo apt-get install -y nodejs

# 验证安装
node -v
npm -v
```

### 获取项目代码

将项目代码克隆到本地：

```bash
git clone https://github.com/alexlii1971/wordpress-microservice.git
cd wordpress-microservice
```

### 配置文件

#### 3.1 配置`wp-config.php`

创建`src/wp-config.php`文件，并添加以下内容：

```php name=src/wp-config.php
<?php
// 获取当前请求的域名或路径，以确定租户ID
$host = $_SERVER['HTTP_HOST'];
$tenantId = getTenantIdByHost($host);

// 加载数据库配置
$dbConfig = include(__DIR__ . '/config/database.php');

// 定义当前租户的数据库连接
define('DB_HOST', $dbConfig['tenants'][$tenantId]['host']);
define('DB_NAME', $dbConfig['tenants'][$tenantId]['name']);
define('DB_USER', $dbConfig['tenants'][$tenantId]['user']);
define('DB_PASSWORD', $dbConfig['tenants'][$tenantId]['password']);

// Multisite配置
define('WP_ALLOW_MULTISITE', true);
define('MULTISITE', true);
define('SUBDOMAIN_INSTALL', false);
define('DOMAIN_CURRENT_SITE', 'example.com');
define('PATH_CURRENT_SITE', '/');
define('SITE_ID_CURRENT_SITE', 1);
define('BLOG_ID_CURRENT_SITE', 1);

// 动态获取租户ID的函数
function getTenantIdByHost($host) {
    // 实现域名到租户ID的映射逻辑
    // 例如，可以查询数据库或配置文件进行映射
    // 这里假设存在一个简单的映射数组
    $tenantMapping = [
        'tenant1.example.com' => 'tenant1',
        'tenant2.example.com' => 'tenant2',
        // 添加其他租户映射
    ];

    return isset($tenantMapping[$host]) ? $tenantMapping[$host] : null;
}

// 定义插件和主题的自定义路径
define('WP_CONTENT_DIR', __DIR__ . '/wp-content');
define('WP_PLUGIN_DIR', WP_CONTENT_DIR . '/' . $tenantId . '/plugins');
define('WP_PLUGIN_URL', 'http://' . $_SERVER['HTTP_HOST'] . '/wp-content/' . $tenantId . '/plugins');
define('WP_THEME_DIR', WP_CONTENT_DIR . '/' . $tenantId . '/themes');
define('WP_THEME_URL', 'http://' . $_SERVER['HTTP_HOST'] . '/wp-content/' . $tenantId . '/themes');

// 其他WordPress配置
```

# 项目部署手册 第二部分

### 配置文件

#### 3.2 配置`nginx.conf`

创建`nginx.conf`文件，并添加以下内容：

```plaintext name=nginx.conf
user  nginx;
worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  example.com;

        root /var/www/html;
        index index.php index.html index.htm;

        location / {
            try_files $uri $uri/ /index.php?$args;
        }

        location ~ \.php$ {
            include fastcgi_params;
            fastcgi_pass unix:/var/run/php/php8.0-fpm.sock;
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        }

        location ~ /\.ht {
            deny all;
        }
    }
}
```

#### 3.3 配置`docker-compose.yml`

创建`docker-compose.yml`文件，并添加以下内容：

```yaml name=docker-compose.yml
version: '3.8'

services:
  wordpress:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:80"
    volumes:
      - ./src:/var/www/html
      - ./nginx.conf:/etc/nginx/nginx.conf
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: root
      WORDPRESS_DB_PASSWORD: root
      WORDPRESS_DB_NAME: wordpress

  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: wordpress
    volumes:
      - db_data:/var/lib/mysql

volumes:
  db_data:
```

### 构建和启动容器

在项目根目录下执行以下命令：

```bash
# 构建Docker镜像
docker-compose build

# 启动Docker容器
docker-compose up -d
```

### 初始化数据库

#### 5.1 进入数据库容器

```bash
docker-compose exec db bash
```

#### 5.2 连接到MySQL数据库

```bash
mysql -u root -p
# 输入密码：root
```

#### 5.3 创建数据库和用户

```sql
CREATE DATABASE wordpress;
CREATE USER 'wp_user'@'%' IDENTIFIED BY 'wp_password';
GRANT ALL PRIVILEGES ON wordpress.* TO 'wp_user'@'%';
FLUSH PRIVILEGES;
EXIT;
```

### 配置并安装WordPress Multisite

#### 6.1 访问WordPress安装页面

在浏览器中访问`http://example.com`并按照提示完成安装过程。

#### 6.2 启用Multisite功能

编辑`src/wp-config.php`文件，添加以下代码：

```php
/* Multisite */
define('WP_ALLOW_MULTISITE', true);
```

#### 6.3 安装Multisite网络

- 登录到WordPress管理后台。
- 进入“工具” -> “网络设置”。
- 根据提示配置Multisite网络。

#### 6.4 更新`src/wp-config.php`文件

根据网络设置页面的提示，更新`src/wp-config.php`文件：

```php
/* Multisite */
define('WP_ALLOW_MULTISITE', true);
define('MULTISITE', true);
define('SUBDOMAIN_INSTALL', false);
define('DOMAIN_CURRENT_SITE', 'example.com');
define('PATH_CURRENT_SITE', '/');
define('SITE_ID_CURRENT_SITE', 1);
define('BLOG_ID_CURRENT_SITE', 1);
```

#### 6.5 更新Nginx配置文件

根据网络设置页面的提示，更新Nginx配置文件：

```plaintext name=nginx.conf
user  nginx;
worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  example.com;

        root /var/www/html;
        index index.php index.html index.htm;

        location / {
            try_files $uri $uri/ /index.php?$args;
        }

        location ~ \.php$ {
            include fastcgi_params;
            fastcgi_pass unix:/var/run/php/php8.0-fpm.sock;
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        }

        location ~ /\.ht {
            deny all;
        }
    }
}
```

# 项目部署手册 第三部分

### 服务拆分与微服务化

#### 7.1 用户服务

##### 7.1.1 用户服务的实现

创建`user-service`文件夹，并编写用户服务代码。

```javascript name=user-service/index.js
const express = require('express');
const app = express();
const port = 3001;

app.use(express.json());

let users = [
    { id: 1, name: 'John Doe', email: 'john.doe@example.com' },
    { id: 2, name: 'Jane Smith', email: 'jane.smith@example.com' }
];

app.get('/users', (req, res) => {
    res.json(users);
});

app.listen(port, () => {
    console.log(`User service running on port ${port}`);
});
```

##### 7.1.2 Dockerfile

创建`user-service/Dockerfile`文件。

```dockerfile name=user-service/Dockerfile
FROM node:14

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

EXPOSE 3001
CMD [ "node", "index.js" ]
```

##### 7.1.3 更新`docker-compose.yml`

更新`docker-compose.yml`文件，添加用户服务配置。

```yaml name=docker-compose.yml
version: '3.8'

services:
  wordpress:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:80"
    volumes:
      - ./src:/var/www/html
      - ./nginx.conf:/etc/nginx/nginx.conf
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: root
      WORDPRESS_DB_PASSWORD: root
      WORDPRESS_DB_NAME: wordpress

  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: wordpress
    volumes:
      - db_data:/var/lib/mysql

  user-service:
    build:
      context: ./user-service
    ports:
      - "3001:3001"

volumes:
  db_data:
```

#### 7.2 文章服务

##### 7.2.1 文章服务的实现

创建`post-service`文件夹，并编写文章服务代码。

```javascript name=post-service/index.js
const express = require('express');
const app = express();
const port = 3002;

app.use(express.json());

let posts = [
    { id: 1, title: 'First Post', content: 'This is the first post.', author_id: 1 },
    { id: 2, title: 'Second Post', content: 'This is the second post.', author_id: 1 }
];

app.get('/posts', (req, res) => {
    res.json(posts);
});

app.listen(port, () => {
    console.log(`Post service running on port ${port}`);
});
```

##### 7.2.2 Dockerfile

创建`post-service/Dockerfile`文件。

```dockerfile name=post-service/Dockerfile
FROM node:14

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

EXPOSE 3002
CMD [ "node", "index.js" ]
```

##### 7.2.3 更新`docker-compose.yml`

更新`docker-compose.yml`文件，添加文章服务配置。

```yaml name=docker-compose.yml
version: '3.8'

services:
  wordpress:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:80"
    volumes:
      - ./src:/var/www/html
      - ./nginx.conf:/etc/nginx/nginx.conf
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: root
      WORDPRESS_DB_PASSWORD: root
      WORDPRESS_DB_NAME: wordpress

  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: wordpress
    volumes:
      - db_data:/var/lib/mysql

  user-service:
    build:
      context: ./user-service
    ports:
      - "3001:3001"

  post-service:
    build:
      context: ./post-service
    ports:
      - "3002:3002"

volumes:
  db_data:
```

# 项目部署手册 第四部分

### 配置负载均衡和服务发现

#### 8.1 安装Traefik

在项目根目录下创建`traefik`文件夹，并添加以下内容：

##### 8.1.1 `traefik.toml`配置文件

```toml name=traefik/traefik.toml
[entryPoints]
  [entryPoints.http]
    address = ":80"

[api]
  dashboard = true

[providers.docker]
  endpoint = "unix:///var/run/docker.sock"
  watch = true
  exposedByDefault = false
```

##### 8.1.2 `docker-compose.yml`新增Traefik服务

```yaml name=docker-compose.yml
version: '3.8'

services:
  wordpress:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:80"
    volumes:
      - ./src:/var/www/html
      - ./nginx.conf:/etc/nginx/nginx.conf
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: root
      WORDPRESS_DB_PASSWORD: root
      WORDPRESS_DB_NAME: wordpress

  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: wordpress
    volumes:
      - db_data:/var/lib/mysql

  user-service:
    build:
      context: ./user-service
    ports:
      - "3001:3001"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.user-service.rule=Host(`user.example.com`)"
      - "traefik.http.services.user-service.loadbalancer.server.port=3001"

  post-service:
    build:
      context: ./post-service
    ports:
      - "3002:3002"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.post-service.rule=Host(`post.example.com`)"
      - "traefik.http.services.post-service.loadbalancer.server.port=3002"

  traefik:
    image: traefik:v2.4
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--entrypoints.web.address=:80"
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
      - "./traefik/traefik.toml:/traefik.toml"

volumes:
  db_data:
```

### 日志和监控

#### 9.1 安装ELK Stack

在项目根目录下创建`elk`文件夹，并添加以下内容：

##### 9.1.1 `docker-compose.yml`新增ELK服务

```yaml name=docker-compose.yml
version: '3.8'

services:
  wordpress:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:80"
    volumes:
      - ./src:/var/www/html
      - ./nginx.conf:/etc/nginx/nginx.conf
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: root
      WORDPRESS_DB_PASSWORD: root
      WORDPRESS_DB_NAME: wordpress

  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: wordpress
    volumes:
      - db_data:/var/lib/mysql

  user-service:
    build:
      context: ./user-service
    ports:
      - "3001:3001"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.user-service.rule=Host(`user.example.com`)"
      - "traefik.http.services.user-service.loadbalancer.server.port=3001"

  post-service:
    build:
      context: ./post-service
    ports:
      - "3002:3002"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.post-service.rule=Host(`post.example.com`)"
      - "traefik.http.services.post-service.loadbalancer.server.port=3002"

  traefik:
    image: traefik:v2.4
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--entrypoints.web.address=:80"
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
      - "./traefik/traefik.toml:/traefik.toml"

  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.10.1
    environment:
      - discovery.type=single-node
    ports:
      - "9200:9200"
    volumes:
      - esdata:/usr/share/elasticsearch/data

  logstash:
    image: docker.elastic.co/logstash/logstash:7.10.1
    volumes:
      - ./elk/logstash.conf:/usr/share/logstash/pipeline/logstash.conf

  kibana:
    image: docker.elastic.co/kibana/kibana:7.10.1
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    ports:
      - "5601:5601"

volumes:
  db_data:
  esdata:
```

##### 9.1.2 `logstash.conf`文件

在`elk`文件夹中创建`logstash.conf`文件，配置Logstash管道。

```plaintext name=elk/logstash.conf
input {
  beats {
    port => 5044
  }
}

filter {
  if [type] == "nginx" {
    grok {
      match => { "message" => "%{COMBINEDAPACHELOG}" }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"
  }
  stdout { codec => rubydebug }
}
```

### 持续集成和持续部署（CI/CD）

#### 10.1 配置GitHub Actions

配置GitHub Actions以实现持续集成和持续部署。

```yaml name=.github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v1

    - name: Cache Docker layers
      uses: actions/cache@v2
      with:
        path: /tmp/.buildx-cache
        key: ${{ runner.os }}-buildx-${{ github.sha }}
        restore-keys: |
          ${{ runner.os }}-buildx-

    - name: Build and push Docker image
      uses: docker/build-push-action@v2
      with:
        context: .
        push: true
        tags: user/repository:latest

  deploy:
    runs-on: ubuntu-latest
    needs: build

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Deploy to server
      run: |
        ssh user@server "cd /path/to/app && docker-compose pull && docker-compose up -d"
```

#### 10.2 配置环境变量

在GitHub仓库中配置以下环境变量：
- `DOCKER_USERNAME`
- `DOCKER_PASSWORD`
- `SSH_PRIVATE_KEY`

### 安全配置

#### 11.1 获取和配置SSL证书

##### 11.1.1 使用Let's Encrypt获取SSL证书

使用Certbot获取SSL证书：

```bash
sudo apt-get install certbot python3-certbot-nginx
sudo certbot --nginx -d example.com
```

##### 11.1.2 更新Nginx配置文件以支持HTTPS

```plaintext name=nginx.conf
server {
    listen 443 ssl;
    server_name example.com;

    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    location / {
        proxy_pass http://backend;
    }
}
```

#### 11.2 防火墙和访问控制

##### 11.2.1 配置防火墙规则

使用UFW配置防火墙规则：

```bash
sudo ufw allow OpenSSH
sudo ufw allow 'Nginx Full'
sudo ufw enable
```

##### 11.2.2 配置访问控制

编辑Nginx配置文件，添加访问控制：

```plaintext name=nginx.conf
location /admin {
    allow 192.168.1.0/24;
    deny all;
}
```

#### 11.3 验证安全配置

##### 11.3.1 验证SSL证书

使用浏览器访问网站，确保SSL证书正确安装。

##### 11.3.2 验证防火墙和访问控制

尝试从不同网络访问受限区域，确保防火墙和访问控制规则生效。

# 项目部署手册 第五部分

### 数据库一致性解决方案

#### 12.1 选择分布式事务管理器

选择一个分布式事务管理器，如：
- Saga
- Two-Phase Commit (2PC)
- TCC (Try-Confirm/Cancel)

#### 12.2 实现Saga模式

Saga模式是一种分布式事务处理方式，通过一系列有序的本地事务来实现全局事务。每个本地事务都包括一个补偿操作，用于回滚事务。

##### 12.2.1 定义Saga步骤

定义每个Saga步骤的业务逻辑和补偿逻辑。

##### 12.2.2 编写Saga协调器

编写Saga协调器来管理Saga的执行和补偿。

```typescript name=saga-coordinator.ts
class SagaCoordinator {
    constructor(private steps: SagaStep[]) {}

    async execute(sagaContext: any) {
        const executedSteps = [];
        try {
            for (const step of this.steps) {
                await step.execute(sagaContext);
                executedSteps.push(step);
            }
        } catch (error) {
            await this.compensate(executedSteps, sagaContext);
            throw error;
        }
    }

    private async compensate(executedSteps: SagaStep[], sagaContext: any) {
        for (const step of executedSteps.reverse()) {
            await step.compensate(sagaContext);
        }
    }
}

interface SagaStep {
    execute(context: any): Promise<void>;
    compensate(context: any): Promise<void>;
}
```

#### 12.3 数据一致性校验

在每个微服务之间引入数据一致性校验机制，确保数据的一致性。

##### 12.3.1 编写一致性校验逻辑

编写定期校验各个服务之间数据一致性的脚本。

```typescript name=data-consistency-checker.ts
class DataConsistencyChecker {
    constructor(private services: DataService[]) {}

    async check() {
        for (const service of this.services) {
            const isConsistent = await service.checkConsistency();
            if (!isConsistent) {
                await this.handleInconsistency(service);
            }
        }
    }

    private async handleInconsistency(service: DataService) {
        // 处理数据不一致的逻辑
    }
}

interface DataService {
    checkConsistency(): Promise<boolean>;
}
```

### 数据迁移

#### 13.1 使用Flyway进行数据迁移

##### 13.1.1 安装Flyway

```bash
# 下载并安装Flyway
curl -L https://flywaydb.org/download/community > flyway-commandline.tar.gz
tar -xzf flyway-commandline.tar.gz
```

##### 13.1.2 配置Flyway

编辑`flyway.conf`文件，添加数据库连接信息。

```plaintext name=flyway.conf
flyway.url=jdbc:mysql://localhost:3306/wordpress
flyway.user=root
flyway.password=root
flyway.schemas=users,posts,comments,files
flyway.locations=filesystem:sql/migrations
```

##### 13.1.3 编写迁移脚本

创建迁移脚本文件夹，并编写迁移脚本。

```sql name=sql/migrations/V1__initial_schema.sql
-- 创建初始数据库架构
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL
);
```

##### 13.1.4 运行迁移

```bash
# 运行Flyway迁移
flyway migrate
```

#### 13.2 使用Liquibase进行数据迁移

##### 13.2.1 安装Liquibase

```bash
# 下载并安装Liquibase
curl -L https://github.com/liquibase/liquibase/releases/download/v4.3.5/liquibase-4.3.5.tar.gz > liquibase.tar.gz
tar -xzf liquibase.tar.gz
```

##### 13.2.2 配置Liquibase

编辑`liquibase.properties`文件，添加数据库连接信息。

```plaintext name=liquibase.properties
url: jdbc:mysql://localhost:3306/wordpress
username: root
password: root
changeLogFile: db/changelog/db.changelog-master.yaml
```

##### 13.2.3 编写迁移脚本

创建迁移脚本文件夹，并编写迁移脚本。

```yaml name=db/changelog/db.changelog-master.yaml
databaseChangeLog:
  - changeSet:
      id: 1
      author: yourname
      changes:
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: int
                  constraints:
                    primaryKey: true
                    nullable: false
                    autoIncrement: true
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: email
                  type: varchar(255)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: password
                  type: varchar(255)
                  constraints:
                    nullable: false
```

##### 13.2.4 运行迁移

```bash
# 运行Liquibase迁移
liquibase update
```

### API文档和示例代码

#### 14.1 用户API

##### 14.1.1 获取用户信息

- **URL**: `/users/:id`
- **方法**: `GET`
- **说明**: 获取指定用户的信息

```json name=example-request.json
{
    "id": 1
}
```

```json name=example-response.json
{
    "id": 1,
    "name": "John Doe",
    "email": "john.doe@example.com"
}
```

#### 14.2 文章API

##### 14.2.1 获取文章列表

- **URL**: `/posts`
- **方法**: `GET`
- **说明**: 获取所有文章的列表

```json name=example-request.json
{}
```

```json name=example-response.json
[
    {
        "id": 1,
        "title": "First Post",
        "content": "This is the first post.",
        "author_id": 1
    },
    {
        "id": 2,
        "title": "Second Post",
        "content": "This is the second post.",
        "author_id": 1
    }
]
```
